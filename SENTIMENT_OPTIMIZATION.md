# –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è Sentiment Analysis - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

## –ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å

### ‚ö° –£—Å–∫–æ—Ä–µ–Ω–∏–µ –≤ ~8-10 —Ä–∞–∑
- **–ë—ã–ª–æ**: –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∫ AI (50 –ø–æ–¥–∫–∞—Å—Ç–æ–≤ = 4-5 –º–∏–Ω—É—Ç)
- **–°—Ç–∞–ª–æ**: –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã —Å rate limiting (50 –ø–æ–¥–∫–∞—Å—Ç–æ–≤ = 30-60 —Å–µ–∫—É–Ω–¥)

### üìÑ TXT —ç–∫—Å–ø–æ—Ä—Ç —Å –ø–æ–¥—Ä–æ–±–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
–¢–µ–ø–µ—Ä—å –±–æ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –¥–µ—Ç–∞–ª—å–Ω—ã–π –æ—Ç—á–µ—Ç —Å:
- –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–¥–∫–∞—Å—Ç–∞ (–¥–∞—Ç–∞, —Å–ø–∏–∫–µ—Ä, sentiment, score)
- Reasoning - –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ –æ—Ü–µ–Ω–∫–∏
- Key Quote - —Å–∞–º–∞—è –ø–æ–∫–∞–∑–∞—Ç–µ–ª—å–Ω–∞—è —Ü–∏—Ç–∞—Ç–∞
- **Full Context** - –ø–æ–ª–Ω—ã–π —Ç–µ–∫—Å—Ç –∏–∑ –ø–æ–¥–∫–∞—Å—Ç–∞ (–¥–æ 2000 —Å–∏–º–≤–æ–ª–æ–≤)
- –°–≤–æ–¥–∫–∞ –ø–æ —Å–ø–∏–∫–µ—Ä–∞–º —Å —Ç—Ä–µ–Ω–¥–∞–º–∏

## –ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

1. [podcast_bot/llm/client.py](podcast_bot/llm/client.py)
   - –î–æ–±–∞–≤–ª–µ–Ω—ã async —Ñ—É–Ω–∫—Ü–∏–∏: `achat()`, `achat_with_history()`
   - Timeout —É–≤–µ–ª–∏—á–µ–Ω –¥–æ 90 —Å–µ–∫—É–Ω–¥ –¥–ª—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

2. [podcast_bot/sentiment/analyzer.py](podcast_bot/sentiment/analyzer.py)
   - –î–æ–±–∞–≤–ª–µ–Ω –º–µ—Ç–æ–¥ `analyze_entity_async()` - –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑
   - –î–æ–±–∞–≤–ª–µ–Ω –º–µ—Ç–æ–¥ `_analyze_sentiment_llm_async()` - async LLM –∑–∞–ø—Ä–æ—Å—ã
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `asyncio.Semaphore` –¥–ª—è rate limiting
   - –°–æ—Ö—Ä–∞–Ω—è–µ—Ç `combined_text` –¥–ª—è TXT —ç–∫—Å–ø–æ—Ä—Ç–∞

3. **podcast_bot/sentiment/exporter.py** (–ù–û–í–´–ô)
   - –§—É–Ω–∫—Ü–∏—è `export_sentiment_to_txt()` - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è TXT –æ—Ç—á–µ—Ç–∞
   - –§–æ—Ä–º–∞—Ç: —á–∏—Ç–∞–µ–º—ã–π —Ç–µ–∫—Å—Ç —Å —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—è–º–∏

4. [podcast_bot/config.py](podcast_bot/config.py)
   - `SENTIMENT_MAX_CONCURRENT_REQUESTS = 10` - –ª–∏–º–∏—Ç –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
   - `SENTIMENT_REQUEST_TIMEOUT = 90.0` - —Ç–∞–π–º–∞—É—Ç –¥–ª—è –∑–∞–ø—Ä–æ—Å–æ–≤
   - `SENTIMENT_INCLUDE_FULL_TEXT = true` - –≤–∫–ª—é—á–∞—Ç—å –ø–æ–ª–Ω—ã–µ —Ç–µ–∫—Å—Ç—ã

5. [podcast_bot/bot/handlers.py](podcast_bot/bot/handlers.py)
   - –£–±—Ä–∞–Ω `run_in_executor()` - –ø—Ä—è–º–æ–π async –≤—ã–∑–æ–≤
   - –î–æ–±–∞–≤–ª–µ–Ω–∞ –æ—Ç–ø—Ä–∞–≤–∫–∞ TXT —Ñ–∞–π–ª–∞ —á–µ—Ä–µ–∑ `answer_document()`
   - –û–±–Ω–æ–≤–ª–µ–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –ø—Ä–æ–≥—Ä–µ—Å—Å–µ

6. [podcast_bot/sentiment/__init__.py](podcast_bot/sentiment/__init__.py)
   - –î–æ–±–∞–≤–ª–µ–Ω —ç–∫—Å–ø–æ—Ä—Ç `export_sentiment_to_txt`

## –ö–∞–∫ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å

### 1. –ó–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞
```bash
cd podcast_bot
python -m bot_main
```

### 2. –í Telegram –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–æ–º–∞–Ω–¥—É
```
/sentiment –±–∏—Ç–∫–æ–∏–Ω
```

### –û–∂–∏–¥–∞–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ

‚úÖ **–°–æ–æ–±—â–µ–Ω–∏–µ –æ –ø—Ä–æ–≥—Ä–µ—Å—Å–µ:**
```
üìä –ê–Ω–∞–ª–∏–∑–∏—Ä—É—é –º–Ω–µ–Ω–∏—è –æ '–±–∏—Ç–∫–æ–∏–Ω'...
‚ö° –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞: –¥–æ 10 –∑–∞–ø—Ä–æ—Å–æ–≤ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
–≠—Ç–æ –∑–∞–π–º–µ—Ç ~30-60 —Å–µ–∫—É–Ω–¥...
```

‚úÖ **–í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏:** ~30-60 —Å–µ–∫—É–Ω–¥ (–≤–º–µ—Å—Ç–æ 4-5 –º–∏–Ω—É—Ç)

‚úÖ **–†–µ–∑—É–ª—å—Ç–∞—Ç –≤–∫–ª—é—á–∞–µ—Ç:**
1. **–ì—Ä–∞—Ñ–∏–∫** (PNG) —Å –ª–∏–Ω–∏—è–º–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–ø–∏–∫–µ—Ä–∞
2. **TXT —Ñ–∞–π–ª** `sentiment_report_–±–∏—Ç–∫–æ–∏–Ω_YYYYMMDD_HHMM.txt` —Å:
   - –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å entity –∏ –¥–∞—Ç–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
   - –î–µ—Ç–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–¥–∫–∞—Å—Ç–∞
   - Full Context —Ä–∞–∑–¥–µ–ª —Å combined_text
   - SUMMARY BY SPEAKER —Å —Ç—Ä–µ–Ω–¥–∞–º–∏
3. **–¢–µ–∫—Å—Ç–æ–≤–∞—è —Å–≤–æ–¥–∫–∞** –≤ HTML —Ñ–æ—Ä–º–∞—Ç–µ

‚úÖ **–í –ª–æ–≥–∞—Ö –∫–æ–Ω—Å–æ–ª–∏:**
```
üîç –ü–æ–∏—Å–∫ —É–ø–æ–º–∏–Ω–∞–Ω–∏–π '–±–∏—Ç–∫–æ–∏–Ω'...
–ù–∞–π–¥–µ–Ω–æ 50 —É–ø–æ–º–∏–Ω–∞–Ω–∏–π
–í 15 –ø–æ–¥–∫–∞—Å—Ç–∞—Ö
‚ö° –ê–Ω–∞–ª–∏–∑–∏—Ä—É—é 15 –ø–æ–¥–∫–∞—Å—Ç–æ–≤ (–º–∞–∫—Å. 10 –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ)...
‚úÖ –ê–Ω–∞–ª–∏–∑ –∑–∞–≤–µ—Ä—à–µ–Ω: 15 —É—Å–ø–µ—à–Ω–æ, 0 –æ—à–∏–±–æ–∫
```

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –î–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∞—Ä–∏—Ñ–æ–≤ OpenRouter

**Free tier (20 req/min):**
```bash
export SENTIMENT_MAX_CONCURRENT=5
```

**Paid tier ($5-20):**
```bash
export SENTIMENT_MAX_CONCURRENT=10  # –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é
```

**Paid tier ($20+):**
```bash
export SENTIMENT_MAX_CONCURRENT=20
```

### –ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–∞—é—Ç —Ç–∞–π–º–∞—É—Ç—ã
```bash
export SENTIMENT_TIMEOUT=120
```

### –û—Ç–∫–ª—é—á–∏—Ç—å –ø–æ–ª–Ω—ã–µ —Ç–µ–∫—Å—Ç—ã –≤ TXT (—Ç–æ–ª—å–∫–æ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ)
```bash
export SENTIMENT_FULL_TEXT=false
```

## –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

### –ï—Å–ª–∏ —á–∞—Å—Ç—å –∑–∞–ø—Ä–æ—Å–æ–≤ failed
–ë–æ—Ç –ø—Ä–æ–¥–æ–ª–∂–∏—Ç —Ä–∞–±–æ—Ç—É –∏ –ø–æ–∫–∞–∂–µ—Ç:
```
‚úÖ –ê–Ω–∞–ª–∏–∑ –∑–∞–≤–µ—Ä—à–µ–Ω: 47 —É—Å–ø–µ—à–Ω–æ, 3 –æ—à–∏–±–æ–∫
```

–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ—Ç–ø—Ä–∞–≤—è—Ç—Å—è –¥–ª—è 47 —É—Å–ø–µ—à–Ω—ã—Ö –ø–æ–¥–∫–∞—Å—Ç–æ–≤.

### –ï—Å–ª–∏ TXT —ç–∫—Å–ø–æ—Ä—Ç failed
–ë–æ—Ç –æ—Ç–ø—Ä–∞–≤–∏—Ç —Ç–æ–ª—å–∫–æ –≥—Ä–∞—Ñ–∏–∫ –∏ —Ç–µ–∫—Å—Ç–æ–≤—É—é —Å–≤–æ–¥–∫—É (fallback).

### –ï—Å–ª–∏ –≤—Å–µ –∑–∞–ø—Ä–æ—Å—ã failed
```
‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∞–Ω–∞–ª–∏–∑–µ: –í—Å–µ –∑–∞–ø—Ä–æ—Å—ã –∑–∞–≤–µ—Ä—à–∏–ª–∏—Å—å –æ—à–∏–±–∫–æ–π. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ OpenRouter.
```

## –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### Benchmark (50 –ø–æ–¥–∫–∞—Å—Ç–æ–≤)
- **–î–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:** 250 —Å–µ–∫—É–Ω–¥ (~4 –º–∏–Ω—É—Ç—ã)
- **–ü–æ—Å–ª–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:** 25-30 —Å–µ–∫—É–Ω–¥
- **–£—Å–∫–æ—Ä–µ–Ω–∏–µ:** ~8-10x üöÄ

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤
- **Memory:** –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ —É–≤–µ–ª–∏—á–µ–Ω–∏–µ (httpx connections –ª–µ–≥–∫–æ–≤–µ—Å–Ω—ã)
- **Network:** –¢–æ—Ç –∂–µ –æ–±—â–∏–π —Ç—Ä–∞—Ñ–∏–∫, –Ω–æ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ
- **CPU:** –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ (I/O bound –æ–ø–µ—Ä–∞—Ü–∏–∏)

## –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

‚úÖ –°—Ç–∞—Ä—ã–µ –º–µ—Ç–æ–¥—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã:
- `analyze_entity()` - sync –≤–µ—Ä—Å–∏—è (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π)
- `chat()` - sync LLM client (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π)

‚úÖ –î—Ä—É–≥–∏–µ —á–∞—Å—Ç–∏ –∫–æ–¥–æ–≤–æ–π –±–∞–∑—ã –Ω–µ –∑–∞—Ç—Ä–æ–Ω—É—Ç—ã

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

‚úÖ **Rate limiting** —á–µ—Ä–µ–∑ `asyncio.Semaphore`
- –ö–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- –ó–∞—â–∏—â–∞–µ—Ç –æ—Ç 429 (Too Many Requests) –æ—à–∏–±–æ–∫

‚úÖ **–¢–∞–π–º–∞—É—Ç—ã** –Ω–∞ –≤—Å–µ –∑–∞–ø—Ä–æ—Å—ã (90 —Å–µ–∫—É–Ω–¥)

‚úÖ **Graceful error handling**
- –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è –ø—Ä–∏ —á–∞—Å—Ç–∏—á–Ω—ã—Ö –æ—à–∏–±–∫–∞—Ö
- Fallback –Ω–∞ –º–µ–Ω—å—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –µ—Å–ª–∏ —á—Ç–æ-—Ç–æ failed

## –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

1. **Telegram file size limit:** 50MB –¥–ª—è –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ (TXT —Ñ–∞–π–ª)
   - –ï—Å–ª–∏ —Å–æ—Ç–Ω–∏ –ø–æ–¥–∫–∞—Å—Ç–æ–≤, —Ñ–∞–π–ª –º–æ–∂–µ—Ç –±—ã—Ç—å –±–æ–ª—å—à–∏–º
   - –¢–µ–∫—Å—Ç –æ–±—Ä–µ–∑–∞–µ—Ç—Å—è –¥–æ 2000 —Å–∏–º–≤–æ–ª–æ–≤ –Ω–∞ –ø–æ–¥–∫–∞—Å—Ç

2. **OpenRouter rate limits** –∑–∞–≤–∏—Å—è—Ç –æ—Ç –±–∞–ª–∞–Ω—Å–∞
   - –ù—É–∂–Ω–æ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å `SENTIMENT_MAX_CONCURRENT` –ø–æ–¥ —Å–≤–æ–π —Ç–∞—Ä–∏—Ñ

3. **Gemini Flash –º–æ–¥–µ–ª—å** –∑–∞—Ö–∞—Ä–¥–∫–æ–∂–µ–Ω–∞ –≤ analyzer.py
   - –ú–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–µ–º—ã–º –≤ –±—É–¥—É—â–µ–º

## –ß—Ç–æ –¥–∞–ª—å—à–µ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

- [ ] –î–æ–±–∞–≤–∏—Ç—å CSV/JSON —ç–∫—Å–ø–æ—Ä—Ç
- [ ] –°–¥–µ–ª–∞—Ç—å –º–æ–¥–µ–ª—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–µ–º–æ–π
- [ ] –î–æ–±–∞–≤–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä –ø–æ —Å–ø–∏–∫–µ—Ä—É –≤ /sentiment –∫–æ–º–∞–Ω–¥–µ
- [ ] –ü—Ä–æ–≥—Ä–µ—Å—Å –±–∞—Ä –≤–æ –≤—Ä–µ–º—è –∞–Ω–∞–ª–∏–∑–∞
- [ ] –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ sentiment –∞–Ω–∞–ª–∏–∑–∞

---

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –∏ –≥–æ—Ç–æ–≤–æ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é
**–î–∞—Ç–∞:** 2026-01-28
