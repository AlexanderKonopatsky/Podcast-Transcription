# Sentiment Analysis Module

–ú–æ–¥—É–ª—å –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è –º–Ω–µ–Ω–∏–π —Å–ø–∏–∫–µ—Ä–æ–≤ –æ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ç–µ–º–∞—Ö –≤–æ –≤—Ä–µ–º–µ–Ω–∏.

## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- üîç –ü–æ–∏—Å–∫ –≤—Å–µ—Ö —É–ø–æ–º–∏–Ω–∞–Ω–∏–π —Ç–µ–º—ã –≤ –±–∞–∑–µ –ø–æ–¥–∫–∞—Å—Ç–æ–≤
- ü§ñ –ê–Ω–∞–ª–∏–∑ sentiment —á–µ—Ä–µ–∑ LLM (Claude)
- üìä –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —Ç—Ä–µ–Ω–¥–æ–≤ –Ω–∞ –≥—Ä–∞—Ñ–∏–∫–∞—Ö
- ‚è±Ô∏è –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –º–Ω–µ–Ω–∏–π –≤–æ –≤—Ä–µ–º–µ–Ω–∏
- üë• –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –º–Ω–µ–Ω–∏–π —Ä–∞–∑–Ω—ã—Ö —Å–ø–∏–∫–µ—Ä–æ–≤

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ Telegram –±–æ—Ç–µ

### –ö–æ–º–∞–Ω–¥–∞ `/sentiment`

```
/sentiment <—Ç–µ–º–∞>
```

**–ü—Ä–∏–º–µ—Ä—ã:**
```
/sentiment –±–∏—Ç–∫–æ–∏–Ω
/sentiment eigen layer
/sentiment –∞–ª—å—Ç–∫–æ–∏–Ω—ã
/sentiment DeFi
```

### –ß—Ç–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç

1. **–¢–µ–∫—Å—Ç–æ–≤—ã–π –∞–Ω–∞–ª–∏–∑** - –∫—Ä–∞—Ç–∫–∞—è —Å–≤–æ–¥–∫–∞ –ø–æ –∫–∞–∂–¥–æ–º—É —Å–ø–∏–∫–µ—Ä—É:
   - –î–∞—Ç–∞ –ø–æ–¥–∫–∞—Å—Ç–∞
   - Sentiment (–±—ã—á–∏–π/–º–µ–¥–≤–µ–∂–∏–π/–Ω–µ–π—Ç—Ä–∞–ª—å–Ω—ã–π)
   - Score (-1 –¥–æ +1)
   - –ö–ª—é—á–µ–≤–∞—è —Ü–∏—Ç–∞—Ç–∞
   - –û–±—â–∏–π —Ç—Ä–µ–Ω–¥

2. **–ì—Ä–∞—Ñ–∏–∫** - –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤–æ –≤—Ä–µ–º–µ–Ω–∏:
   - –õ–∏–Ω–∏–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–ø–∏–∫–µ—Ä–∞
   - –í—Ä–µ–º–µ–Ω–Ω–∞—è —à–∫–∞–ª–∞
   - –¶–≤–µ—Ç–æ–≤—ã–µ –∑–æ–Ω—ã (–Ω–µ–≥–∞—Ç–∏–≤–Ω–∞—è/–Ω–µ–π—Ç—Ä–∞–ª—å–Ω–∞—è/–ø–æ–∑–∏—Ç–∏–≤–Ω–∞—è)

## –ü—Ä–∏–º–µ—Ä—ã –≤—ã–≤–æ–¥–∞

```
üìä –ê–Ω–∞–ª–∏–∑ –º–Ω–µ–Ω–∏–π –æ '–±–∏—Ç–∫–æ–∏–Ω':

**–ó–µ–Ω—É—Ä:**
  2025-09-15: üìà –±—ã—á–∏–π (+0.65)
    üí¨ "–°–µ–π—á–∞—Å —Ö–æ—Ä–æ—à–∞—è —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞..."
  2025-10-12: ‚û°Ô∏è –Ω–µ–π—Ç—Ä–∞–ª—å–Ω—ã–π (+0.15)
    üí¨ "–†–æ—Å—Ç –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—Å—è, –Ω–æ –æ—Å—Ç–æ—Ä–æ–∂–Ω–æ"
  2025-11-03: üìâ –º–µ–¥–≤–µ–∂–∏–π (-0.25)
    üí¨ "–ú–µ–¥–≤–µ–¥–∏ –ø—Ä–∞–≤—è—Ç —Ä—ã–Ω–∫–æ–º"
  üìâ –¢—Ä–µ–Ω–¥: —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –±–æ–ª–µ–µ –Ω–µ–≥–∞—Ç–∏–≤–Ω—ã–º (Œî-0.90)

**–°–µ—Ä–µ–≥–∞:**
  2025-09-18: üìà –±—ã—á–∏–π (+0.45)
  2025-10-15: üìà –±—ã—á–∏–π (+0.52)
  2025-11-01: ‚û°Ô∏è –Ω–µ–π—Ç—Ä–∞–ª—å–Ω—ã–π (+0.30)
  üìä –¢—Ä–µ–Ω–¥: —Å—Ç–∞–±–∏–ª—å–Ω–æ–µ –º–Ω–µ–Ω–∏–µ (Œî-0.15)
```

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### 1. SentimentAnalyzer (`analyzer.py`)

–û—Å–Ω–æ–≤–Ω–æ–π –∫–ª–∞—Å—Å –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞:

```python
analyzer = SentimentAnalyzer()
sentiments = analyzer.analyze_entity(
    entity="–±–∏—Ç–∫–æ–∏–Ω",
    speaker=None,  # –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: —Ñ–∏–ª—å—Ç—Ä –ø–æ —Å–ø–∏–∫–µ—Ä—É
    start_date="2025-09-01",  # –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ
    end_date="2025-11-30",
    top_k=50  # –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —á–∞–Ω–∫–æ–≤ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞
)
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
```python
[
    {
        "entity": "–±–∏—Ç–∫–æ–∏–Ω",
        "date": "2025-11-03",
        "speaker": "–ó–µ–Ω—É—Ä",
        "sentiment": "–º–µ–¥–≤–µ–∂–∏–π",
        "score": -0.25,
        "reasoning": "–°–ø–∏–∫–µ—Ä –æ—Å—Ç–æ—Ä–æ–∂–µ–Ω...",
        "key_quote": "–ú–µ–¥–≤–µ–¥–∏ –ø—Ä–∞–≤—è—Ç —Ä—ã–Ω–∫–æ–º"
    },
    ...
]
```

### 2. –í–∏–∑—É–∞–ª–∏–∑–∞—Ç–æ—Ä (`visualizer.py`)

–°–æ–∑–¥–∞–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–æ–≤:

```python
from sentiment import create_sentiment_chart

chart_buffer = create_sentiment_chart(sentiments, entity="–±–∏—Ç–∫–æ–∏–Ω")
# –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç BytesIO —Å PNG –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º
```

### 3. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ handlers (`bot/handlers.py`)

–ù–æ–≤–∞—è –∫–æ–º–∞–Ω–¥–∞ `/sentiment` –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ —Ö–µ–Ω–¥–ª–µ—Ä—ã –±–æ—Ç–∞.

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –ê–ª–≥–æ—Ä–∏—Ç–º —Ä–∞–±–æ—Ç—ã

1. **–ü–æ–∏—Å–∫ —É–ø–æ–º–∏–Ω–∞–Ω–∏–π** - RAG search –ø–æ –±–∞–∑–µ –ø–æ–¥–∫–∞—Å—Ç–æ–≤
2. **–ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞** - –ø–æ –ø–æ–¥–∫–∞—Å—Ç—É (–¥–∞—Ç–∞ + —Å–ø–∏–∫–µ—Ä)
3. **–ê–Ω–∞–ª–∏–∑ —á–µ—Ä–µ–∑ LLM** - –¥–ª—è –∫–∞–∂–¥–æ–π –≥—Ä—É–ø–ø—ã:
   ```
   –ü—Ä–æ–º–ø—Ç ‚Üí Claude API ‚Üí JSON —Å sentiment
   ```
4. **–ê–≥—Ä–µ–≥–∞—Ü–∏—è** - —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –¥–∞—Ç–∞–º
5. **–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è** - matplotlib –≥—Ä–∞—Ñ–∏–∫

### Sentiment Scale

- **+1.0 –¥–æ +0.6**: üöÄ –û—á–µ–Ω—å –ø–æ–∑–∏—Ç–∏–≤–Ω–æ (bullish)
- **+0.6 –¥–æ +0.2**: üìà –ü–æ–∑–∏—Ç–∏–≤–Ω–æ
- **+0.2 –¥–æ -0.2**: ‚û°Ô∏è –ù–µ–π—Ç—Ä–∞–ª—å–Ω–æ
- **-0.2 –¥–æ -0.6**: üìâ –ù–µ–≥–∞—Ç–∏–≤–Ω–æ
- **-0.6 –¥–æ -1.0**: üêª –û—á–µ–Ω—å –Ω–µ–≥–∞—Ç–∏–≤–Ω–æ (bearish)

### –ú–æ–¥–µ–ª—å LLM

–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `anthropic/claude-sonnet-4.5` –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ sentiment.

–ú–æ–¥–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç:
- –¶–∏—Ç–∞—Ç—ã –∏–∑ –ø–æ–¥–∫–∞—Å—Ç–∞ (–¥–æ 3000 —Å–∏–º–≤–æ–ª–æ–≤)
- –ö–æ–Ω—Ç–µ–∫—Å—Ç (–¥–∞—Ç–∞, —Å–ø–∏–∫–µ—Ä, —Ç–µ–º–∞)

–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:
- Structured JSON —Å sentiment, score, reasoning, key_quote

## –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

1. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: –ê–Ω–∞–ª–∏–∑ 50 —á–∞–Ω–∫–æ–≤ –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å 1-3 –º–∏–Ω—É—Ç—ã
2. **–¢–æ—á–Ω–æ—Å—Ç—å**: –ó–∞–≤–∏—Å–∏—Ç –æ—Ç –∫–∞—á–µ—Å—Ç–≤–∞ RAG –ø–æ–∏—Å–∫–∞ –∏ LLM
3. **–ò—Å—Ç–æ—Ä–∏—è**: –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Ç–æ–ª—å–∫–æ –ø—Ä–æ–∏–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–æ–¥–∫–∞—Å—Ç—ã

## –ë—É–¥—É—â–∏–µ —É–ª—É—á—à–µ–Ω–∏—è

- [ ] –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∞–Ω–∞–ª–∏–∑–∞
- [ ] –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Ç–µ–º
- [ ] –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö –≤ CSV/JSON
- [ ] –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ —Ä–µ–∑–∫–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö –º–Ω–µ–Ω–∏–π
- [ ] –ê–Ω–∞–ª–∏–∑ —ç–º–æ—Ü–∏–π (–Ω–µ —Ç–æ–ª—å–∫–æ sentiment)
- [ ] –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ –≥—Ä–∞—Ñ–∏–∫–∏ (plotly)

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### Console test

```python
from sentiment import SentimentAnalyzer, create_sentiment_chart

# –ê–Ω–∞–ª–∏–∑
analyzer = SentimentAnalyzer()
sentiments = analyzer.analyze_entity("–±–∏—Ç–∫–æ–∏–Ω", top_k=30)

# –¢–µ–∫—Å—Ç–æ–≤–∞—è —Å–≤–æ–¥–∫–∞
summary = analyzer.summarize_trend(sentiments)
print(summary)

# –ì—Ä–∞—Ñ–∏–∫
chart = create_sentiment_chart(sentiments, "–±–∏—Ç–∫–æ–∏–Ω")
with open("sentiment.png", "wb") as f:
    f.write(chart.getvalue())
```

### –í Telegram –±–æ—Ç–µ

–ü—Ä–æ—Å—Ç–æ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ –∫–æ–º–∞–Ω–¥—É:
```
/sentiment –±–∏—Ç–∫–æ–∏–Ω
```

–ë–æ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
1. –ù–∞–π–¥–µ—Ç —É–ø–æ–º–∏–Ω–∞–Ω–∏—è
2. –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç
3. –í–µ—Ä–Ω–µ—Ç –≥—Ä–∞—Ñ–∏–∫ + —Ç–µ–∫—Å—Ç
