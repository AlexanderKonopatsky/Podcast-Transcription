# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Sentiment Analysis

## –ë—ã—Å—Ç—Ä—ã–π —Ç–µ—Å—Ç (–±–µ–∑ –±–æ—Ç–∞)

### 1. –ö–æ–Ω—Å–æ–ª—å–Ω—ã–π —Ç–µ—Å—Ç

```bash
cd podcast_bot/sentiment
python test_sentiment.py –±–∏—Ç–∫–æ–∏–Ω
```

–ß—Ç–æ –ø—Ä–æ–∏–∑–æ–π–¥–µ—Ç:
- –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –≤—Å–µ —É–ø–æ–º–∏–Ω–∞–Ω–∏—è "–±–∏—Ç–∫–æ–∏–Ω"
- –í—ã–≤–µ–¥–µ—Ç —Ç–µ–∫—Å—Ç–æ–≤—É—é —Å–≤–æ–¥–∫—É –≤ –∫–æ–Ω—Å–æ–ª—å
- –°–æ—Ö—Ä–∞–Ω–∏—Ç –≥—Ä–∞—Ñ–∏–∫ –≤ `sentiment_–±–∏—Ç–∫–æ–∏–Ω.png`

### 2. –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π —Ç–µ—Å—Ç

```bash
python test_sentiment.py
# –í–≤–µ–¥–∏—Ç–µ —Ç–µ–º—É: eigen layer
```

## –¢–µ—Å—Ç –≤ Telegram –±–æ—Ç–µ

### –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞

```bash
cd podcast_bot
python bot_main.py
```

–ò–ª–∏ –µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ –¥—Ä—É–≥—É—é —Ç–æ—á–∫—É –≤—Ö–æ–¥–∞:
```bash
python main.py  # –µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è aiogram polling
```

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã

1. –û—Ç–∫—Ä–æ–π—Ç–µ –±–æ—Ç–∞ –≤ Telegram
2. –û—Ç–ø—Ä–∞–≤—å—Ç–µ: `/sentiment –±–∏—Ç–∫–æ–∏–Ω`
3. –î–æ–∂–¥–∏—Ç–µ—Å—å –∞–Ω–∞–ª–∏–∑–∞ (1-3 –º–∏–Ω—É—Ç—ã)
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ:
   - ‚úÖ –ì—Ä–∞—Ñ–∏–∫ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è
   - ‚úÖ –¢–µ–∫—Å—Ç —Å –¥–∞—Ç–∞–º–∏ –∏ —Ü–∏—Ç–∞—Ç–∞–º–∏
   - ‚úÖ –≠–º–æ–¥–∑–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ
   - ‚úÖ –¢—Ä–µ–Ω–¥—ã —Ä–∞—Å—Å—á–∏—Ç–∞–Ω—ã

### –¢–µ—Å—Ç–æ–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã

**–î–æ–ª–∂–Ω—ã —Ä–∞–±–æ—Ç–∞—Ç—å:**
```
/sentiment –±–∏—Ç–∫–æ–∏–Ω
/sentiment eigen layer
/sentiment ethereum
```

**–î–æ–ª–∂–Ω—ã –≤–µ—Ä–Ω—É—Ç—å "–Ω–µ –Ω–∞–π–¥–µ–Ω–æ":**
```
/sentiment –∫—Å–¥—Ñ–ª–≤–∫–º—á—Å  (–Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∞—è —Ç–µ–º–∞)
```

**–ì—Ä–∞–Ω–∏—á–Ω—ã–µ —Å–ª—É—á–∞–∏:**
```
/sentiment  (–±–µ–∑ –∞—Ä–≥—É–º–µ–Ω—Ç–∞ - –¥–æ–ª–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å help)
```

## –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

### 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ RAG –ø–æ–∏—Å–∫–∞

```python
from rag.search import search

results = search("–±–∏—Ç–∫–æ–∏–Ω", top_k=10)
print(f"–ù–∞–π–¥–µ–Ω–æ: {len(results)} —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤")
for r in results[:3]:
    print(f"- {r['metadata']['date']}: {r['text'][:100]}")
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** –°–ø–∏—Å–æ–∫ —á–∞–Ω–∫–æ–≤ —Å —É–ø–æ–º–∏–Ω–∞–Ω–∏—è–º–∏ –±–∏—Ç–∫–æ–∏–Ω–∞

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä–∞

```python
from sentiment import SentimentAnalyzer

analyzer = SentimentAnalyzer()
sentiments = analyzer.analyze_entity("–±–∏—Ç–∫–æ–∏–Ω", top_k=5)
print(f"Sentiment –∑–∞–ø–∏—Å–µ–π: {len(sentiments)}")
for s in sentiments:
    print(f"{s['date']}: {s['sentiment']} ({s['score']})")
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** JSON –æ–±—ä–µ–∫—Ç—ã —Å sentiment –¥–∞–Ω–Ω—ã–º–∏

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏

```python
from sentiment import create_sentiment_chart

# –ú–æ–∫–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
test_sentiments = [
    {
        "entity": "—Ç–µ—Å—Ç",
        "date": "2025-11-01",
        "speaker": "–ó–µ–Ω—É—Ä",
        "score": 0.5
    },
    {
        "entity": "—Ç–µ—Å—Ç",
        "date": "2025-11-15",
        "speaker": "–ó–µ–Ω—É—Ä",
        "score": -0.3
    }
]

chart = create_sentiment_chart(test_sentiments, "—Ç–µ—Å—Ç")
print(f"–ì—Ä–∞—Ñ–∏–∫ —Å–æ–∑–¥–∞–Ω: {len(chart.getvalue())} –±–∞–π—Ç")
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** BytesIO –æ–±—ä–µ–∫—Ç —Å PNG –¥–∞–Ω–Ω—ã–º–∏

## –û—Ç–ª–∞–¥–∫–∞ –ø—Ä–æ–±–ª–µ–º

### –ü—Ä–æ–±–ª–µ–º–∞: "–ò–Ω–¥–µ–∫—Å –Ω–µ –Ω–∞–π–¥–µ–Ω"

**–†–µ—à–µ–Ω–∏–µ:**
```bash
cd podcast_bot
python scripts/index_podcasts.py
```

### –ü—Ä–æ–±–ª–µ–º–∞: "API –æ—à–∏–±–∫–∞"

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `.env` —Ñ–∞–π–ª:
   ```
   OPENROUTER_API_KEY=sk-or-...
   ```
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –±–∞–ª–∞–Ω—Å –Ω–∞ OpenRouter
3. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –¥—Ä—É–≥—É—é –º–æ–¥–µ–ª—å –≤ `config.py`

### –ü—Ä–æ–±–ª–µ–º–∞: "–ù–µ –Ω–∞—Ö–æ–¥–∏—Ç —É–ø–æ–º–∏–Ω–∞–Ω–∏—è"

**–û—Ç–ª–∞–¥–∫–∞:**
```python
from rag.search import search

# –¢–µ—Å—Ç 1: –û–±—â–∏–π –ø–æ–∏—Å–∫
results = search("–±–∏—Ç–∫–æ–∏–Ω", top_k=5)
print(f"–ù–∞–π–¥–µ–Ω–æ: {len(results)}")

# –¢–µ—Å—Ç 2: –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —á—Ç–æ –≤ –∏–Ω–¥–µ–∫—Å–µ
import json
with open("podcast_bot/data/chunks.json", "r", encoding="utf-8") as f:
    chunks = json.load(f)
    print(f"–í—Å–µ–≥–æ —á–∞–Ω–∫–æ–≤ –≤ –∏–Ω–¥–µ–∫—Å–µ: {len(chunks)}")
    # –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ø–µ—Ä–≤—ã–µ 3
    for chunk in chunks[:3]:
        print(f"- {chunk['metadata']['date']}: {chunk['text'][:50]}")
```

### –ü—Ä–æ–±–ª–µ–º–∞: "–ì—Ä–∞—Ñ–∏–∫ –Ω–µ —Å–æ–∑–¥–∞–µ—Ç—Å—è"

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π:**
```bash
pip install matplotlib>=3.10.0
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞ matplotlib backend:**
```python
import matplotlib
print(f"Backend: {matplotlib.get_backend()}")
# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å: Agg (non-interactive)
```

### –ü—Ä–æ–±–ª–µ–º–∞: "LLM –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π JSON"

**–û—Ç–ª–∞–¥–∫–∞:**
1. –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ raw response –≤ –∫–æ–Ω—Å–æ–ª–∏
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –º–æ–¥–µ–ª—å - `claude-sonnet-4.5`
3. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —É–º–µ–Ω—å—à–∏—Ç—å –¥–ª–∏–Ω—É —Ç–µ–∫—Å—Ç–∞ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞

**–í—Ä–µ–º–µ–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ:**
–í `analyzer.py` —É–º–µ–Ω—å—à–∏—Ç–µ `text[:3000]` –¥–æ `text[:1500]`

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –õ–æ–≥–∏ –±–æ—Ç–∞

–ï—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:
```bash
tail -f podcast_bot/logs/interactions_*.jsonl
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

```python
import time

start = time.time()
# –í–∞—à —Ç–µ—Å—Ç
elapsed = time.time() - start
print(f"–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è: {elapsed:.1f} —Å–µ–∫")
```

**–ù–æ—Ä–º–∞:**
- –ü–æ–∏—Å–∫ (RAG): < 1 —Å–µ–∫
- –ê–Ω–∞–ª–∏–∑ 1 –ø–æ–¥–∫–∞—Å—Ç–∞ (LLM): 2-5 —Å–µ–∫
- –ê–Ω–∞–ª–∏–∑ 10 –ø–æ–¥–∫–∞—Å—Ç–æ–≤: 20-50 —Å–µ–∫
- –°–æ–∑–¥–∞–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–∞: < 1 —Å–µ–∫

## Checklist –ø–µ—Ä–µ–¥ –¥–µ–ø–ª–æ–µ–º

- [ ] –ö–æ–Ω—Å–æ–ª—å–Ω—ã–π —Ç–µ—Å—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] Telegram –∫–æ–º–∞–Ω–¥–∞ `/sentiment` —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –ì—Ä–∞—Ñ–∏–∫ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [ ] –¢–µ–∫—Å—Ç–æ–≤–∞—è —Å–≤–æ–¥–∫–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞
- [ ] –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç (–Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∞—è —Ç–µ–º–∞)
- [ ] Help —Å–æ–æ–±—â–µ–Ω–∏–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [ ] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∞–∫—Ç—É–∞–ª—å–Ω–∞
- [ ] –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ

## –ù–∞–≥—Ä—É–∑–æ—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –°—Ç—Ä–µ—Å—Å-—Ç–µ—Å—Ç

```python
# –ê–Ω–∞–ª–∏–∑ —à–∏—Ä–æ–∫–æ–π —Ç–µ–º—ã (–º–Ω–æ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤)
analyzer.analyze_entity("–∫—Ä–∏–ø—Ç–∞", top_k=100)
```

**–û–∂–∏–¥–∞–Ω–∏–µ:**
- –ù–µ –¥–æ–ª–∂–Ω–æ –ø–∞–¥–∞—Ç—å —Å MemoryError
- –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è < 5 –º–∏–Ω—É—Ç
- –ì—Ä–∞—Ñ–∏–∫ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —á–∏—Ç–∞–µ–º—ã–º (–Ω–µ —Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –ª–∏–Ω–∏–π)

### –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã

–í Telegram –æ—Ç–ø—Ä–∞–≤—å—Ç–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ –∫–æ–º–∞–Ω–¥ –ø–æ–¥—Ä—è–¥:
```
/sentiment –±–∏—Ç–∫–æ–∏–Ω
/sentiment ethereum
/sentiment solana
```

**–û–∂–∏–¥–∞–Ω–∏–µ:**
- –í—Å–µ –∑–∞–ø—Ä–æ—Å—ã –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ
- –ù–µ—Ç –≥–æ–Ω–æ–∫ –¥–∞–Ω–Ω—ã—Ö
- –ö–∞–∂–¥—ã–π –ø–æ–ª—É—á–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç

## –ì–æ—Ç–æ–≤–æ!

–ï—Å–ª–∏ –≤—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—à–ª–∏ —É—Å–ø–µ—à–Ω–æ - —Ñ—É–Ω–∫—Ü–∏—è –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é! üéâ
